trigger:

- main # Запускати Pipeline при коміті до гілки main



variables:

  # Замініть на ім'я вашого ACR (наприклад, smartgovacr.azurecr.io)

  acrRegistry: 'smartgovcontainerregistry.azurecr.io'

  imageRepository: 'smartgov-nginx-test' # Ім'я образу в ACR

  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'

  # Ім'я Service Connection з Кроку 3

  acrServiceConnection: 'azure-subscription-connection' 



stages:

- stage: Build

  displayName: Build and Push Image

  jobs:

  - job: Build

    displayName: Build

    pool:

      vmImage: 'ubuntu-latest' # Використовуємо Linux-агента

    steps:

    - task: Docker@2

      displayName: Build and push image to ACR

      inputs:

        containerRegistry: '$(acrServiceConnection)'

        repository: '$(imageRepository)'

        command: 'buildAndPush'

        Dockerfile: '$(dockerfilePath)'

        tags: '$(Build.BuildId)' # Унікальний тег
